<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




















  
  
  <link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link rel="stylesheet" href="https://fonts.loli.net/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext">
  






<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.0.1',
    sidebar: {"position":"left","display":"always","offset":12,"onmobile":true,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-3001225672102099",
    enable_page_level_ads: true
  });
</script>


  



  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/0f81ff2f.js","daovoice")
  daovoice('init', {
      app_id: "3a22f8cc"
    });
  daovoice('update');
  </script>



  <meta name="description" content="NumpyNumpy是Python的一种开源的数值计算扩展。可以用来存储和处理大型矩阵，比Python自身的嵌套列表结构(nested list structure)要高效得多。在实际工作中直接使用情况较少。  数组   numpy.array()   12345678910111213141516import numpy as npa = np.array([1, 2, 3, 4])print(">
<meta name="keywords" content="Python">
<meta property="og:type" content="article">
<meta property="og:title" content="Python之数据分析">
<meta property="og:url" content="https://hunter1023.github.io/2020/06/13/Python之数据分析/index.html">
<meta property="og:site_name" content="特叔服务">
<meta property="og:description" content="NumpyNumpy是Python的一种开源的数值计算扩展。可以用来存储和处理大型矩阵，比Python自身的嵌套列表结构(nested list structure)要高效得多。在实际工作中直接使用情况较少。  数组   numpy.array()   12345678910111213141516import numpy as npa = np.array([1, 2, 3, 4])print(">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-09-08T12:23:24.864Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Python之数据分析">
<meta name="twitter:description" content="NumpyNumpy是Python的一种开源的数值计算扩展。可以用来存储和处理大型矩阵，比Python自身的嵌套列表结构(nested list structure)要高效得多。在实际工作中直接使用情况较少。  数组   numpy.array()   12345678910111213141516import numpy as npa = np.array([1, 2, 3, 4])print(">






  <link rel="canonical" href="https://hunter1023.github.io/2020/06/13/Python之数据分析/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Python之数据分析 | 特叔服务</title>
  




  <script async src="//www.googletagmanager.com/gtag/js?id=[object Object]"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-121247993-1');
    }
  </script>









  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">特叔服务</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hunter1023.github.io/2020/06/13/Python之数据分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hunter">
      <meta itemprop="description" content="Tough times never last, but tough people do.">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="特叔服务">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Python之数据分析

              
            
          </h1>
        

        <div class="post-meta">
			
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-06-13 08:14:22" itemprop="dateCreated datePublished" datetime="2020-06-13T08:14:22+08:00">2020-06-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-09-08 20:23:24" itemprop="dateModified" datetime="2020-09-08T20:23:24+08:00">2020-09-08</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/数据分析/" itemprop="url" rel="index"><span itemprop="name">数据分析</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2020/06/13/Python之数据分析/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/06/13/Python之数据分析/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
             阅读次数： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="Numpy"><a href="#Numpy" class="headerlink" title="Numpy"></a>Numpy</h2><p>Numpy是Python的一种开源的<strong>数值计算扩展</strong>。可以用来<strong>存储和处理大型矩阵</strong>，比Python自身的<strong>嵌套列表结构(nested list structure)</strong>要<strong>高效得多</strong>。在实际工作中<strong>直接使用情况较少</strong>。</p>
<ul>
<li><p><strong>数组</strong></p>
<p>  <code>numpy.array()</code></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">a = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line">print(a)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出为：array([1, 2, 3, 4])</span></span><br><span class="line"><span class="comment"># 和 列表 相似，但处理效率要高很多</span></span><br><span class="line"></span><br><span class="line">a[<span class="number">0</span>] = <span class="number">5</span></span><br><span class="line"><span class="comment"># 得到数组 array([5, 2, 3, 4])</span></span><br><span class="line"></span><br><span class="line">a + <span class="number">1</span></span><br><span class="line"><span class="comment"># 数组中每个元素都+1，得到数组 array([6, 3, 4, 5])</span></span><br><span class="line"><span class="comment"># 减法、乘除法同理</span></span><br><span class="line"></span><br><span class="line">b = np.array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]])</span><br><span class="line"><span class="comment"># 可以生成多维数组</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>查看数组中<strong>存储的数据类型</strong>：<code>dtype</code></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(b.dtype)</span><br><span class="line"><span class="comment"># 输出为：int32</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="Pandas"><a href="#Pandas" class="headerlink" title="Pandas"></a>Pandas</h2><p>Pandas是<strong>基于Numpy</strong>的一种工具，是为了<strong>解决数据分析任务</strong>而创建的。Pandas<strong>提供了大量</strong>能使我们<strong>快速便捷地处理数据</strong>的<strong>函数和方法</strong>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br></pre></td></tr></table></figure>
<h3 id="两种数据结构"><a href="#两种数据结构" class="headerlink" title="两种数据结构"></a>两种数据结构</h3><h4 id="Series-一维"><a href="#Series-一维" class="headerlink" title="Series  (一维)"></a>Series  (一维)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">s1 = pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line">print(s1)</span><br><span class="line"><span class="comment"># 输出为：</span></span><br><span class="line"><span class="comment"># 0    1</span></span><br><span class="line"><span class="comment"># 1    2</span></span><br><span class="line"><span class="comment"># 2    3</span></span><br><span class="line"><span class="comment"># 3    4</span></span><br><span class="line"><span class="comment"># dtype: int64</span></span><br><span class="line"></span><br><span class="line">print(s.index)</span><br><span class="line"><span class="comment"># 输出为：RangeIndex(start=0, stop=4, step=1)</span></span><br><span class="line"></span><br><span class="line">s1[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">s2 = pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], index = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</span><br><span class="line">print(s2)</span><br><span class="line"><span class="comment"># 输出为：</span></span><br><span class="line"><span class="comment"># a    1</span></span><br><span class="line"><span class="comment"># b    2</span></span><br><span class="line"><span class="comment"># c    3</span></span><br><span class="line"><span class="comment"># d    4</span></span><br><span class="line"><span class="comment"># dtype: int64</span></span><br><span class="line"></span><br><span class="line">s2[<span class="string">'b'</span>]</span><br><span class="line"></span><br><span class="line">print(s2[[<span class="string">'a'</span>, <span class="string">'c'</span>]])</span><br><span class="line"><span class="comment"># 索引多个值 需要用 列表 来表示</span></span><br><span class="line"><span class="comment"># 输出为：</span></span><br><span class="line"><span class="comment"># a    1</span></span><br><span class="line"><span class="comment"># c    3</span></span><br><span class="line"><span class="comment"># dtype: int64</span></span><br><span class="line"></span><br><span class="line">d = &#123;<span class="string">'hunter'</span>:<span class="string">'smart'</span>, <span class="string">'peter'</span>:<span class="string">'handsome'</span>&#125;</span><br><span class="line">s3 = pd.Series(d)</span><br><span class="line">print(s3)</span><br><span class="line"><span class="comment"># 输出为：</span></span><br><span class="line"><span class="comment"># hunter       smart</span></span><br><span class="line"><span class="comment"># peter     handsome</span></span><br><span class="line"><span class="comment"># dtype: object</span></span><br><span class="line"></span><br><span class="line">s3 = pd.Series(d, index=[<span class="string">'hunter'</span>, <span class="string">'peter'</span>, <span class="string">'haha'</span>])</span><br><span class="line">print(s3)</span><br><span class="line"><span class="comment"># 输出为：</span></span><br><span class="line"><span class="comment"># hunter       smart</span></span><br><span class="line"><span class="comment"># peter     handsome</span></span><br><span class="line"><span class="comment"># haha           NaN</span></span><br><span class="line"><span class="comment"># dtype: object</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符串类型在Series里显示的类型为object</span></span><br><span class="line"><span class="comment"># 可转换类型</span></span><br><span class="line">s2 = s2.astype(<span class="string">'str'</span>) <span class="comment"># 将 数值类型 转换为 字符串类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将浮点数类型转换为int类型</span></span><br><span class="line">x_value = titanic[<span class="string">'Fare'</span>].astype(int)</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="DataFrame-二维"><a href="#DataFrame-二维" class="headerlink" title="DataFrame (二维)"></a>DataFrame (二维)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;</span><br><span class="line">    <span class="string">'name'</span>:[<span class="string">'qinlu'</span>, <span class="string">'lulu'</span>, <span class="string">'qinqin'</span>]</span><br><span class="line">    <span class="string">'sex'</span>:[<span class="string">'male'</span>, <span class="string">'male'</span>, <span class="string">'female'</span>]</span><br><span class="line">    <span class="string">'age'</span>:[<span class="number">18</span>, <span class="number">18</span>, <span class="number">25</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pd.DataFrame(d)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个空的数据框</span></span><br><span class="line">data = pd.DataFrame()</span><br></pre></td></tr></table></figure>
<p>得到如下二维表格：</p>
<table>
<thead>
<tr>
<th></th>
<th>name</th>
<th>sex</th>
<th>age</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>qinlu</td>
<td>male</td>
<td>18</td>
</tr>
<tr>
<td>1</td>
<td>lulu</td>
<td>male</td>
<td>18</td>
</tr>
<tr>
<td>2</td>
<td>qinqin</td>
<td>female</td>
<td>25</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]) <span class="comment"># 效果类似 Series</span></span><br><span class="line">df</span><br></pre></td></tr></table></figure>
<p>得到如下二维表格：</p>
<table>
<thead>
<tr>
<th></th>
<th>0</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
</tr>
<tr>
<td>2</td>
<td>3</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
</tr>
</tbody>
</table>
<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]], columns=list(<span class="string">'abcd'</span>))</span><br><span class="line"><span class="comment"># 提供两行数据和 各列的列名</span></span><br><span class="line"></span><br><span class="line">df</span><br></pre></td></tr></table></figure>
<p>得到如下二维表格：</p>
<table>
<thead>
<tr>
<th></th>
<th>a</th>
<th>b</th>
<th>c</th>
<th>d</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
</tr>
<tr>
<td>1</td>
<td>3</td>
<td>4</td>
<td>5</td>
<td>6</td>
</tr>
</tbody>
</table>
<p>DataFrame的<strong>列的顺序默认为提供的顺序</strong>。如下操作可以<strong>调整列的顺序</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = df[[<span class="string">'b'</span>, <span class="string">'d'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>]]</span><br><span class="line">df</span><br></pre></td></tr></table></figure>
<p>得到如下二维表格：</p>
<table>
<thead>
<tr>
<th></th>
<th>b</th>
<th>d</th>
<th>c</th>
<th>a</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>2</td>
<td>4</td>
<td>3</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>4</td>
<td>6</td>
<td>5</td>
<td>3</td>
</tr>
</tbody>
</table>
<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(d)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 概览数据</span></span><br><span class="line">df.info()</span><br><span class="line"><span class="comment"># &lt;class 'pandas.core.frame.DataFrame'&gt;</span></span><br><span class="line"><span class="comment"># RangeIndex: 3 entries, 0 to 2</span></span><br><span class="line"><span class="comment"># Data columns (total 3 columns):</span></span><br><span class="line"><span class="comment">#  #   Column  Non-Null Count  Dtype </span></span><br><span class="line"><span class="comment"># ---  ------  --------------  ----- </span></span><br><span class="line"><span class="comment">#  0   name    3 non-null      object</span></span><br><span class="line"><span class="comment">#  1   sex     3 non-null      object</span></span><br><span class="line"><span class="comment">#  2   age     3 non-null      int64 </span></span><br><span class="line"><span class="comment"># dtypes: int64(1), object(2)</span></span><br><span class="line"><span class="comment"># memory usage: 200.0+ bytes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看每个列的数据类型</span></span><br><span class="line">df.dtypes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看某个列的数据类型</span></span><br><span class="line">df[<span class="string">'name'</span>].dtype</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取某一行</span></span><br><span class="line">df.iloc[<span class="number">0</span>] <span class="comment">#根据 索引(不论是否自定义了标签名) 读取某一行 (推荐，数据量大了之后更适用)</span></span><br><span class="line">df.loc[<span class="number">0</span>] <span class="comment"># 根据 具体标签名 读取某一行</span></span><br><span class="line"><span class="comment"># 上述两种方式输出相同：</span></span><br><span class="line"><span class="comment"># name    lulu</span></span><br><span class="line"><span class="comment"># sex     male</span></span><br><span class="line"><span class="comment"># age       18</span></span><br><span class="line"><span class="comment"># Name: 1, dtype: object</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取多行</span></span><br><span class="line">df.iloc[<span class="number">0</span>:<span class="number">2</span>] <span class="comment"># 闭区间</span></span><br><span class="line">df[<span class="number">0</span>:<span class="number">2</span>] <span class="comment"># 开区间</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#获取某一列</span></span><br><span class="line">df[<span class="string">'age'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取多个列</span></span><br><span class="line">df[[<span class="string">'age'</span>, <span class="string">'name'</span>]]</span><br><span class="line">df.iloc[:, <span class="number">0</span>:<span class="number">7</span>] <span class="comment"># 所有行和前七列</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取二维表格部分列</span></span><br><span class="line">df[[<span class="string">'age'</span>, <span class="string">'name'</span>]][<span class="number">1</span>:<span class="number">2</span>] <span class="comment"># 开区间</span></span><br><span class="line">df[[<span class="string">'age'</span>, <span class="string">'name'</span>]][<span class="string">'age'</span>] <span class="comment"># 获取部分列中的指定列</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取二维表格部分区域</span></span><br><span class="line">df.iloc[<span class="number">1</span>:<span class="number">2</span>, <span class="number">1</span>:<span class="number">2</span>] <span class="comment"># 指出 索引，iloc不支持布尔类型的过滤</span></span><br><span class="line">df.loc[<span class="string">'a'</span>, [<span class="string">'age'</span>, <span class="string">'name'</span>]] <span class="comment"># 指出 行和列的 标签名</span></span><br><span class="line">df.loc[df.age == <span class="number">19</span>, <span class="string">'age'</span>] <span class="comment"># 指出 符合条件的行的列值 和 列标签</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更改具体值</span></span><br><span class="line">df[<span class="string">'age'</span>] = <span class="number">21</span> <span class="comment"># 统一更改整个列</span></span><br><span class="line">df[<span class="string">'age'</span>] += <span class="number">1</span> <span class="comment"># 统一更改整个列</span></span><br><span class="line">df[<span class="string">'age'</span>] = [<span class="number">21</span>, <span class="number">18</span>, <span class="number">18</span>] <span class="comment"># 自定义更改列中的值</span></span><br><span class="line">df[<span class="string">'age'</span>][<span class="number">1</span>] = <span class="number">22</span> <span class="comment"># 更改某个值</span></span><br><span class="line">df.loc[df.age == <span class="number">19</span>, <span class="string">'age'</span>] = <span class="number">20</span> <span class="comment"># 更改某个筛选范围的值</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更改标签</span></span><br><span class="line">df.index = list(<span class="string">'abc'</span>) <span class="comment"># 更改行标签，通常处理的数据量很大，不建议修改</span></span><br><span class="line">df.columns = list(<span class="string">'abcd'</span>) <span class="comment"># 更改列标签</span></span><br></pre></td></tr></table></figure>
<hr>
<h5 id="Series通过reset-index-可以转换为DataFrame"><a href="#Series通过reset-index-可以转换为DataFrame" class="headerlink" title="Series通过reset_index()可以转换为DataFrame"></a>Series通过<code>reset_index()</code>可以转换为DataFrame</h5><p>Series原有的index也是<strong>变为一个列</strong></p>
<hr>
<h4 id="代表反转"><a href="#代表反转" class="headerlink" title="~代表反转"></a><code>~</code>代表反转</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~ (df.age &gt; <span class="number">19</span>) <span class="comment">#等价于 df.age &lt;= 19</span></span><br></pre></td></tr></table></figure>
<hr>
<h4 id="筛选"><a href="#筛选" class="headerlink" title="筛选"></a>筛选</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">df[df.age == <span class="number">18</span>] <span class="comment"># 筛选出 年龄=18的 所有行(筛选 结果为True 的行)</span></span><br><span class="line">df.query(<span class="string">'age == 18'</span>) <span class="comment"># 和上一条代码等价，条件需要引号标注</span></span><br><span class="line"></span><br><span class="line">df[(df.age == <span class="number">18</span>) | (df.name == <span class="string">'qinqin'</span>)] <span class="comment"># 通过 括号和&amp;/|运算符 进行多条件筛选</span></span><br><span class="line">df.query(<span class="string">"(age == 18) | (name == 'qinqin')"</span>) <span class="comment"># 注意括号不要冲突</span></span><br></pre></td></tr></table></figure>
<hr>
<h4 id="增删"><a href="#增删" class="headerlink" title="增删"></a>增删</h4><p>pandas中<strong>增删的运算效率低</strong>，尽量不使用。</p>
<ul>
<li><code>del</code>：将指定列从存储空间中删除</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">del</span> df.loc[df.age == <span class="number">19</span>, <span class="string">'age'</span>]</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>drop()</code>：删除指定项时<strong>返回的是视图</strong>，<strong>数据仍然在存储空间中</strong></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df.drop(<span class="string">'age'</span>, axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># axis=1表示列，axis=0表示行(默认)</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="Pandas基础命令速查表"><a href="#Pandas基础命令速查表" class="headerlink" title="Pandas基础命令速查表"></a><a href="https://www.kesci.com/home/project/59e389b54663f7655c48f518/code" target="_blank" rel="noopener">Pandas基础命令速查表</a></h3><hr>
<h3 id="读取-写入文件"><a href="#读取-写入文件" class="headerlink" title="读取/写入文件"></a>读取/写入文件</h3><h4 id="读取"><a href="#读取" class="headerlink" title="读取"></a>读取</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">df = pd.read_csv(<span class="string">'xxxx.csv'</span>, encoding=<span class="string">'xxx'</span>, sep=<span class="string">','</span>, names=<span class="string">'abcdefg'</span>)</span><br><span class="line"></span><br><span class="line">df = pd.read_table(<span class="string">'xxxx'</span>, sep=<span class="string">'\t'</span>)</span><br></pre></td></tr></table></figure>
<p><code>read_csv()</code>的参数：</p>
<ul>
<li><p>文件名</p>
</li>
<li><p><code>encoding</code>：指定编码</p>
<p>  python<strong>默认以utf-8编码</strong>读取文件。如果报错无法正确显示文件内容，可以<strong>将编码改为gbk</strong>等进行读取。</p>
</li>
<li><p><code>sep</code>：指定分隔符，<strong>默认为逗号<code>,</code></strong></p>
<p>有的文件由于不标准等原因，采用其他分隔符如<code>\t</code>，可<strong>通过指定分隔符优化显示</strong>。</p>
<p><code>sep=&#39;\s+&#39;</code>：将<strong>tab</strong>和<strong>多个空格</strong>都<strong>当成一样的分隔符</strong>。</p>
</li>
<li><p><code>parse_dates</code>：将数据<strong>解析为日期</strong></p>
<p>  <code>parse_dates = True</code>：<strong>尝试解析所有</strong>可能为日期类型的列；</p>
<p>  <code>parse_dates = [1, 2]</code>：<strong>尝试解析给定列</strong>为日期类型的列。</p>
<p>  <code>parse_dates = [[1, 2]]</code>：<strong>尝试解析给定列</strong>为日期类型的列，<strong>并将这些列聚合成为1个列</strong></p>
</li>
<li><p><code>names</code></p>
<p>  指定<strong>列名</strong>，<strong>默认为文件中的第一行</strong>。如果自定义列名，文件中的第一行<strong>将作为第一行数据显示</strong>。</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">df.info() <span class="comment"># 概览数据</span></span><br><span class="line"></span><br><span class="line">df.head(<span class="number">10</span>) <span class="comment"># 默认读取前5行</span></span><br><span class="line">df.tail(<span class="number">20</span>) <span class="comment"># 默认读取最后5行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据当前已有的列生成新列</span></span><br><span class="line">df[<span class="string">'avg'</span>] = (df.bottom + df.top) / <span class="number">2</span></span><br></pre></td></tr></table></figure>
<hr>
<h4 id="写入"><a href="#写入" class="headerlink" title="写入"></a>写入</h4><p><code>to_csv()</code></p>
<hr>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><ul>
<li><p><code>T</code>：<strong>转置</strong>表格</p>
<p>  <code>df.T</code></p>
</li>
<li><p><code>shape</code>：获取数据框的<strong>行数</strong>和<strong>列数</strong>（<strong>元组</strong>存储）</p>
<p>  如<code>df.shape</code>：可能得到如<code>(10,5)</code>（10行5列）</p>
</li>
<li><p><code>columns</code>：获取所有列</p>
</li>
<li><p><code>index</code>：查看索引信息</p>
</li>
<li><p><code>set_index()</code>：<strong>设置索引</strong></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crime = crime.set_index(<span class="string">'Year'</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="筛选函数"><a href="#筛选函数" class="headerlink" title="筛选函数"></a>筛选函数</h4><ul>
<li><p><code>sort_values()</code>：<strong>按值排序</strong>，默认<strong>升序</strong></p>
<p>参数：</p>
<ul>
<li><p><code>by</code>：指出排序依据的字段</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">df.sort_values(by = <span class="string">'avg'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下述方式效果类似(返回的是avg的有序数组)</span></span><br><span class="line">df.avg.sort_values()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据多个条件排序</span></span><br><span class="line">df.sort_values(by = [<span class="string">'avg'</span>, <span class="string">'city'</span>]) <span class="comment"># 排序根据unicode而不是拼音，如果想要按照拼音顺序，需要将中文和英文字母关联(可新建一个城市首字母缩写的列)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>ascending</code>：默认为True(升序)</p>
</li>
<li><p><code>inplace</code>：是否<strong>用排序后的数据集替换原来的数据</strong>，<strong>默认为False</strong></p>
</li>
</ul>
</li>
<li><p><code>sort_index()</code>：<strong>按索引排序</strong></p>
</li>
<li><p><code>rank()</code>：给出<strong>排名</strong></p>
<p>  参数：</p>
<ul>
<li><p><code>ascending</code>：默认为True(升序)</p>
</li>
<li><p><code>method</code></p>
<ul>
<li><code>&#39;average&#39;</code> (<strong>默认</strong>，如前5个人分数相同，则排名为<strong>(1+5) / 2</strong>  （<strong>最大值和最小值的加权平均数</strong>）)</li>
<li><code>&#39;min&#39;</code> (取最小值)</li>
<li><code>&#39;max&#39;</code></li>
<li><code>&#39;first&#39;</code> (<strong>不考虑并列情况</strong>)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df[<span class="string">'rank'</span>] = df.avg.rank(ascending=<span class="literal">False</span>, method=<span class="string">'min'</span>) <span class="comment"># 按照平均工资排名，将排名作为新的列加入表格</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>unique()</code>：<strong>去除重复</strong>项</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.city.unique()</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>value_counts()</code>：对Series的<strong>每个值进行计数</strong>并且<strong>排序</strong></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.education.value_counts()</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>describe()</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.avg.describe()</span><br></pre></td></tr></table></figure>
<p>得到：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">count 	5031.000000</span><br><span class="line">mean 	17.111409</span><br><span class="line">std 	8.996242</span><br><span class="line">min 	1.500000</span><br><span class="line">25% 	11.500000</span><br><span class="line">50% 	15.000000</span><br><span class="line">75% 	22.500000</span><br><span class="line">max 	75.000000</span><br><span class="line">Name: avg dtype: float64</span><br></pre></td></tr></table></figure>
<ul>
<li><code>count</code>：计数</li>
<li><code>mean</code>：平均数</li>
<li><code>std</code>：<strong>标准差</strong></li>
</ul>
<p><code>describe()</code>的统计内容会<strong>自动忽略空值</strong></p>
</li>
<li><p><code>count()</code></p>
</li>
<li><p><code>max()</code></p>
</li>
<li><p><code>min()</code></p>
</li>
<li><p><code>last()</code></p>
</li>
<li><p><code>mean()</code></p>
<p>  对<strong>整个数据框</strong>求平均值，结果为<strong>按列(默认)分别计算平均值</strong>，得到一个<strong>Series</strong>；</p>
<p>  对Series求平均值，结果则为一个平均数</p>
<p>  参数：<code>axis=0</code> （0为按列，1为按行）</p>
</li>
<li><p><code>sum()</code></p>
</li>
<li><p><code>median()</code>：<strong>中位数</strong></p>
</li>
<li><p><code>std()</code>：<strong>标准差</strong></p>
</li>
<li><p><code>var()</code>：<strong>方差</strong></p>
</li>
<li><p><code>cumsum()</code>：<strong>累加</strong></p>
</li>
<li><p><code>pandas.cut()</code>：<strong>分类统计</strong></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4等分</span></span><br><span class="line">pd.cut(df.avg, bins=<span class="number">4</span>, label=list(<span class="string">'abcd'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义分隔区间</span></span><br><span class="line"><span class="comment"># 为了能够全部包含需要分类的数据区间，最后的值一般一个取极大的值</span></span><br><span class="line">pd.cut(df.avg, bins=[<span class="number">0</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">100</span>], label=[<span class="string">'0~5'</span>, <span class="string">'5~10'</span>, <span class="string">'10~20'</span>, <span class="string">'20~30'</span>, <span class="string">'30~100'</span>])</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>pandas.qcut()</code></p>
</li>
<li><p><code>isin()</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 找到英格兰(England)、意大利(Italy)和俄罗斯(Russia)的射正率(Shooting Accuracy)</span></span><br><span class="line">euro12.loc[euro12[<span class="string">'Team'</span>].isin([<span class="string">'England'</span>, <span class="string">'Italy'</span>, <span class="string">'Russia'</span>]), [<span class="string">'Team'</span>, <span class="string">'Shooting Accuracy'</span>]]</span><br></pre></td></tr></table></figure>
<p><strong>可以和<code>~</code>配合使用，达到不存在的函数<code>isnotin()</code>的效果</strong>。</p>
</li>
<li><p><code>idxmax()</code>：返回<strong>请求轴</strong>上<strong>第一次</strong>出现<strong>最大值</strong>(不包括<code></code>NA/null`)的<strong>索引</strong></p>
<p>  参数：</p>
<ul>
<li><code>axis=0</code>：0对应行，1对应列</li>
</ul>
</li>
</ul>
<hr>
<h4 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h4><p><strong>MySQL</strong>难以完成<strong>分组排序</strong>。</p>
<ul>
<li><p><code>groupby()</code>：分组</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">df.groupby(by = <span class="string">'city'</span>)</span><br><span class="line"><span class="comment"># 得到如下已存入内存的提示：</span></span><br><span class="line"><span class="comment"># &lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x0000012CF16A41C8&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当前分组下，对各分组中的各列进行统计</span></span><br><span class="line">df.groupby(by = <span class="string">'city'</span>).count()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当前分组下，各分组中各列的最大值</span></span><br><span class="line">df.groupby(by = <span class="string">'city'</span>).max()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当前分组下，对各分组中某列的最大值</span></span><br><span class="line">df.groupby(by = <span class="string">'city'</span>)[<span class="string">'avg'</span>].max()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多字段分组</span></span><br><span class="line">df.groupby(by = [<span class="string">'city'</span>, <span class="string">'workYear'</span>]).mean()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> df.groupby(by=[<span class="string">'city'</span>]):</span><br><span class="line">    <span class="comment"># 打印每个分组中的元素数量</span></span><br><span class="line">    print(len(k[<span class="number">1</span>]))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 打印分组的依据元素(具体的city)</span></span><br><span class="line">    print(k)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 打印分割线</span></span><br><span class="line">    print(<span class="string">'**'</span> *<span class="number">10</span>) <span class="comment"># 20个星号</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 打印分组中元素的详细内容</span></span><br><span class="line">    print(v)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 打印同个城市中，最高薪资和最低薪资的差值</span></span><br><span class="line">    print(max(v.avg) - min(v[<span class="string">'avg'</span>]))</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h5 id="多表关联"><a href="#多表关联" class="headerlink" title="多表关联"></a>多表关联</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">position = pd.read_csv(<span class="string">'position.csv'</span>)</span><br><span class="line">company = pd.read_csv(<span class="string">'company.csv'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>merge()</code>函数 —— 根据<strong>具体的键值</strong></p>
<p>相当于<strong>SQL中的JOIN</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">position.merge(right = company, how=<span class="string">'left'</span>, on=<span class="string">'companyId'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更改列名</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式一：单独更改一个列名</span></span><br><span class="line">col = list(company.columns)</span><br><span class="line">col[<span class="number">0</span>] = <span class="string">'id'</span></span><br><span class="line">company.columns = col</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式二：利用rename()更改指定列名</span></span><br><span class="line">company.rename(columns=&#123;<span class="string">'0'</span>:<span class="string">'id'</span>, <span class="string">'1'</span>:<span class="string">'xxx'</span>&#125;, inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">pd.merge(left=position, right=company, how=<span class="string">'inner'</span>, left_on=<span class="string">'companyId'</span>, right_on=<span class="string">'id'</span>)</span><br></pre></td></tr></table></figure>
<p>参数：</p>
<ul>
<li><code>left/right</code>：关联的表</li>
<li><code>how</code>：<strong>关联的方式</strong><ul>
<li><code>inner</code>(<strong>默认</strong>)</li>
<li><code>outer</code></li>
<li><code>left</code></li>
</ul>
</li>
<li><p><code>right</code></p>
</li>
<li><p><code>on</code>：具体的键值(在<strong>两个表中对应列名相同</strong>时使用)</p>
</li>
<li><code>left_on/right_on</code>：具体的键值(在<strong>两个表中对应列名不同</strong>时使用，关联之后<strong>保留不同名的列</strong>)</li>
</ul>
<hr>
</li>
<li><p><code>join()</code>：根据<strong>索引</strong>(<strong>行号</strong>)</p>
<p>按照索引关联很有<strong>局限性</strong>。</p>
<ul>
<li>只要两个表<strong>列名不同</strong>，不加任何参数就可直接使用</li>
<li>如果两个表有重复的列名，需要制定<code>lsuffix</code>，<code>rsuffix</code>参数</li>
<li><strong>默认左外连接</strong>(LEFT JOIN)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1.join(df2)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>concat()</code>：<strong>堆叠</strong></p>
<p>  类似于SQL中的<strong>UNION</strong>，多个表<strong>暴力堆叠</strong>，新的表<strong>包含多个表的所有列</strong>，没有对应列值的表项为NaN。</p>
<p>  参数：</p>
<ul>
<li><p><code>axis</code>:</p>
<ul>
<li><strong>0</strong>：<strong>上下</strong>堆叠(<strong>默认</strong>，<strong>相同列名</strong>会<strong>合并</strong> )</li>
<li><strong>1</strong>：<strong>左右</strong>堆叠</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.concat([company, position], axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<hr>
<p><strong>区分辨别</strong></p>
<p><strong>Series</strong>级别可以直接输入<strong>索引标签</strong>进行筛选；<strong>DataFrame</strong>级别，需要通过<code>loc</code>进行筛选。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">position.groupby(by=[<span class="string">'city'</span>, <span class="string">'education'</span>]).mean().avg[<span class="string">'上海'</span>]</span><br><span class="line"></span><br><span class="line">position.groupby(by=[<span class="string">'city'</span>, <span class="string">'education'</span>]).mean().loc[<span class="string">'上海'</span>, <span class="string">'博士'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># reset_index() 重置索引</span></span><br><span class="line">position.groupby(by=[<span class="string">'city'</span>, <span class="string">'education'</span>]).mean().reset_index()[<span class="string">'上海'</span>, <span class="string">'博士'</span>]</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>不借助<code>groupby</code></strong>，如何<strong>设置多重索引</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sort_values 用于排序，set_index 将列设置为索引</span></span><br><span class="line">position.sort_values(by=[<span class="string">'city'</span>, <span class="string">'education'</span>]).set_index([<span class="string">'city'</span>, <span class="string">'education'</span>])</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><p><code>agg()</code><strong>函数</strong></p>
<p>  <code>agg()</code>是聚合函数，得到DataFrame。参数有：</p>
<ul>
<li><code>func</code>：<strong>实现某种统计功能的函数</strong></li>
<li><p><code>axis=0</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grouped_user 是通过groupby('user_id')得到的 DataFrameGroupBy 对象</span></span><br><span class="line">user_life = grouped_user[<span class="string">'order_dt'</span>].agg([<span class="string">'first'</span>, <span class="string">'last'</span>]) <span class="comment"># order_dt列是时间格式，first 和 last 函数能分别得到最早和最迟的时间</span></span><br><span class="line">user_life.head()</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<hr>
<h4 id="文本函数"><a href="#文本函数" class="headerlink" title="文本函数"></a>文本函数</h4><ul>
<li><p><code>str.count()</code>：统计指定字符出现的次数</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">position.positionLabels.str.count(<span class="string">'分析师'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>str.find()</code>：查找指定字符出现的位置</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">position.positionLabels.str.find(<span class="string">'数据'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>str[1:-1]</code>：去除<strong>表示列表的方括号</strong></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">position.positionLabels.str[<span class="number">1</span>:<span class="number">-1</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>str.replace(&quot;&#39;&quot;, &quot;&quot;)</code>：<strong>去除列表中元素的单引号</strong></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">position.positionLabels.str[<span class="number">1</span>:<span class="number">-1</span>].str.replace(<span class="string">"'"</span>, <span class="string">""</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><code>str.startwith()</code>：筛选<strong>以指定字符开头</strong>的字符串</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">euro12[<span class="string">'Team'</span>].str.startwith(<span class="string">'G'</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><code>str.split()</code>：<strong>拆分</strong>单元格内容</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df2 = df[<span class="string">'某一列'</span>].str.split(<span class="string">'指定分隔符'</span>, expand=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># 默认会删去分隔符</span></span><br><span class="line"><span class="comment"># expand=True 能让拆分后的单元格内容 由 列表类型 变为 DataFrame(默认为False)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>str.extract()</code>：<strong>提取</strong>单元格中<strong>所需内容</strong></p>
<p>  参数：</p>
<ul>
<li><code>pat</code>：字符串或<strong>正则表达式</strong><ul>
<li><strong>只有用<code>()</code>包裹的部分才会被保留</strong></li>
<li>Python中使用正则表达式<strong>命名捕获组语法</strong>为：<code>(?P&lt;name&gt;Expression)</code>，即<strong>将<code>name</code>作为列名</strong></li>
</ul>
</li>
<li><code>flags</code>：整型</li>
<li><p><code>expand</code>：是否将提取的内容由列表类型变为DataFrame</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 提取 '建筑年代'列 的数字，剥离 年建</span></span><br><span class="line">df3[<span class="string">'建筑年代'</span>] = df3[<span class="string">'建筑年代'</span>].str.extract(<span class="string">'(\d+)年建'</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>str(xxx)</code>：将其他类型的数据(如时间)<strong>转为字符串</strong></p>
</li>
</ul>
<hr>
<h4 id="时间相关"><a href="#时间相关" class="headerlink" title="时间相关"></a>时间相关</h4><ul>
<li><p>Python中的 datetime模块</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"></span><br><span class="line">now = datetime.now() <span class="comment"># 获取当前日期和时间</span></span><br><span class="line">print(now)</span><br><span class="line"></span><br><span class="line">print(datetime.date.today()) <span class="comment"># 获取当前日期</span></span><br><span class="line"></span><br><span class="line">delta = now - datetime(<span class="number">2017</span>,<span class="number">6</span>,<span class="number">27</span>,<span class="number">10</span>,<span class="number">10</span>,<span class="number">10</span>,<span class="number">10</span>) <span class="comment"># 获取日期相差值</span></span><br><span class="line">print(delta) <span class="comment"># 得到 xxdays, xx:xx:xx.xxx</span></span><br><span class="line"></span><br><span class="line">print(delta.days) <span class="comment"># 72天数</span></span><br><span class="line"></span><br><span class="line">print(delta.seconds) <span class="comment"># 秒数</span></span><br><span class="line">print(delta.microseconds) <span class="comment"># 微秒数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2061年？我们真的有这一年的数据？创建一个函数并用它去修复这个bug</span></span><br><span class="line"><span class="comment"># x是一个 YYYY-mm-dd格式 的日期</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fix_century</span><span class="params">(x)</span>:</span></span><br><span class="line">    year = x.year</span><br><span class="line">    <span class="keyword">if</span> year &gt; <span class="number">2000</span>:</span><br><span class="line">       year -= <span class="number">100</span></span><br><span class="line">    <span class="keyword">return</span> datetime.date(year, x.month, x.day)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">text = <span class="string">'2019-09-07'</span></span><br><span class="line">y = datetime.strptime(text, <span class="string">'%Y-%m-%d'</span>) <span class="comment"># 把字符串转为日期</span></span><br><span class="line">print(y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当前日期的前后n日期</span></span><br><span class="line">print(datetime.date.today()+timedelta(days=<span class="number">-1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得某一日期的月初和月末</span></span><br><span class="line">text=<span class="string">'2019-09-07'</span></span><br><span class="line">month_first=datetime.strptime(text[:<span class="number">8</span>]+<span class="string">'01'</span>,<span class="string">'%Y-%m-%d'</span>)</span><br><span class="line">print(month_first) <span class="comment">#输出结果为:2019-09-01 00:00:00</span></span><br><span class="line"></span><br><span class="line">month_end=datetime.strptime(text[:<span class="number">5</span>] + str(int(text[<span class="number">5</span>:<span class="number">7</span>])+<span class="number">1</span>) + <span class="string">'-01'</span>,<span class="string">'%Y-%m-%d'</span>)+timedelta(days=<span class="number">-1</span>)</span><br><span class="line">print(month_end) <span class="comment"># 输出结果为:2019-09-30 00:00:00</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>datetime.now()</code>：获取<strong>当前日期和时间</strong>(和MySQL的<code>NOW()</code>相同)</li>
<li><code>datetime.date.today()</code>：获取<strong>当前日期</strong></li>
<li><code>datetime(year, month, day[, hour[, minute[, second[, microsecond[,tzinfo]]]]])</code>：生成指定的时间</li>
<li><code>datetime.date(year, month, day)</code>：构造<strong>日期格式</strong>，但是<strong>数据类型不变</strong></li>
<li><code>datetime.strptime()</code>：把字符串转为日期(和pandas的to_datetime函数作用相同)</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><p>Pandas中的 to_datetime函数</p>
<p>  <code>pandas.to_datetime()</code>：<strong>将指定列的 数据类型 转换为 指定格式的 时间类型</strong></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">crime[<span class="string">'Year'</span>] = pandas.to_datetime(crime[<span class="string">'Year'</span>], format=<span class="string">'%Y'</span>)</span><br><span class="line"></span><br><span class="line">date=[<span class="string">'2017-6-26'</span>, <span class="string">'2017-6-27'</span>]</span><br><span class="line">print(pd.to_datetime(date))</span><br><span class="line"><span class="comment">#输出结果为:DatetimeIndex(['2017-06-26', '2017-06-27'], dtype='datetime64[ns]', freq=None)</span></span><br></pre></td></tr></table></figure>
<p>  <strong>format参数</strong>和<a href="https://hunter1023.github.io/2020/06/28/Python%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/">数据可视化-模块 datetime </a>中<strong>含义一致</strong></p>
</li>
</ul>
<hr>
<ul>
<li><p><code>astype()</code></p>
<p>  可以<strong>将时间类型的数据更改精度</strong>。<code>pandas.to_datetime()</code><strong>默认转换的时间类型</strong>为<code>datetime64[ns]</code>，<strong>精度为ns(纳秒)级</strong>。</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df[<span class="string">'datetime'</span>] = pd.to_datetime(df[<span class="string">'datetime'</span>], format=<span class="string">'%Y%m%d'</span>)</span><br><span class="line">df[<span class="string">'month'</span>] = df[<span class="string">'datetime'</span>].values.astype(<span class="string">'datetime64[M]'</span>) <span class="comment"># 将精度转换为M(月份)级别，日子一律会更改为1日</span></span><br></pre></td></tr></table></figure>
<p>  上述代码，使用<code>values</code>将Series内的数值以<code>ndarray</code>或<code>ndarray-like</code>的形式返回，因为<code>datetime64[ns]</code>无法直接转换为<code>datetime64[M]</code>类型</p>
</li>
</ul>
<hr>
<ul>
<li><p><code>pandas.date_range()</code>：<strong>创建时间序列</strong></p>
<p>  <strong>参数：</strong></p>
<ul>
<li><code>start</code>：起始时间</li>
<li><code>end</code>：结束时间</li>
<li><code>periods</code>：当<strong>只声明了</strong>起始时间<strong>或</strong>结束时间时，需要告知<strong>时间范围</strong></li>
<li><p><code>freq</code>：<strong>时间频率</strong>（默认为<code>&#39;D&#39;</code>(<strong>Calendar</strong> day frequency)）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">pd.date_range(start=datetime.now(), periods=<span class="number">6</span>, freq=<span class="string">'B'</span>) <span class="comment"># 'B'的含义为 营业日频率(business day frequency)</span></span><br><span class="line"><span class="comment"># 得到：</span></span><br><span class="line"><span class="comment"># DatetimeIndex(['2020-07-13 20:34:18.990072', '2020-07-14 20:34:18.990072',</span></span><br><span class="line"><span class="comment">#               '2020-07-15 20:34:18.990072', '2020-07-16 20:34:18.990072',</span></span><br><span class="line"><span class="comment">#               '2020-07-17 20:34:18.990072', '2020-07-20 20:34:18.990072'],</span></span><br><span class="line"><span class="comment">#              dtype='datetime64[ns]', freq='B')</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pd.date_range(start=<span class="string">'20130809'</span>,periods=<span class="number">8</span>,freq=<span class="string">'SM'</span>) <span class="comment"># 'SM'的含义为 月中和月末(semi-month end frequency)</span></span><br><span class="line"><span class="comment"># 得到：</span></span><br><span class="line"><span class="comment"># DatetimeIndex(['2020-07-15', '2020-07-31', '2020-08-15', '2020-08-31',</span></span><br><span class="line"><span class="comment">#               '2020-09-15', '2020-09-30', '2020-10-15', '2020-10-31'],</span></span><br><span class="line"><span class="comment">#              dtype='datetime64[ns]', freq='SM-15')</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pd.date_range(start=datetime.now(),periods=<span class="number">5</span>,freq=<span class="string">'2H20min'</span>) <span class="comment"># 时间间隔140min</span></span><br><span class="line"></span><br><span class="line">pd.date_range(start=<span class="string">'20190623'</span>, periods=<span class="number">10</span>, freq=<span class="string">'1D10U'</span>) <span class="comment"># 时间间隔1天10微秒</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><p><code>numpy.timedelta64()</code></p>
<p>Numpy允许两个Datetime值相减，这个操作产生一个<strong>带有时间单位</strong>的数字。由于NumPy的核心<strong>没有物理量(物理单位)系统</strong>，因此<strong>创建了<code>timedelta64</code>数据类型以补充<code>datetime64</code></strong>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x = np.datetime64(<span class="string">'2017-08-03'</span>) - np.datetime64(<span class="string">'2017-07-15'</span>)</span><br><span class="line"><span class="comment"># 得到的结果是 x = numpy.timedelta64(19,'D') # 第一个参数为数字，第二个参数为单位</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 利用timedelta64() 消除单位</span></span><br><span class="line">x / np.timedelta64(<span class="number">1</span>, <span class="string">'D'</span>) <span class="comment"># 得到的结果是19.0</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<ul>
<li><p><strong>以日期时间序列为索引</strong>的最多日期<strong>相差天数</strong></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(df.index.max() - df.index.min()).days</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>以日期时间序列为索引</strong>的数据框中一共<strong>有多少个月</strong></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d = df.resample(<span class="string">'BM'</span>).last()</span><br><span class="line">len(d.index) <span class="comment"># 'DatetimeIndex' object has no attribute 'count'，因此不能使用count函数计数</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>把字符串转成日期</p>
</li>
</ul>
<hr>
<h5 id="重新采样"><a href="#重新采样" class="headerlink" title="重新采样"></a>重新采样</h5><p>重新采样指<strong>将时间序列从一个频率转换为另一个频率</strong>的过程。</p>
<ul>
<li><p><strong>降</strong>采样（向下采样）</p>
<p>  高频时间序列变为低频，<strong>时间粒度变大</strong>。如：原有100个时间点，变为10个时间点</p>
</li>
<li><p>升采样（向上采样）</p>
<p>  低频时间序列变为高频，<strong>时间粒度变小</strong>。，</p>
</li>
<li><p>同频之间的切换</p>
<p>  比如W-WED(weekly on Wednesday 每周三)转换到W-FRI(每周五）</p>
</li>
</ul>
<p><strong>函数<code>resample()</code></strong>：</p>
<p>不同于<strong>groupby关注特征值</strong>的分组操作，它在<strong>以时间序列为索引</strong>的数据框中使用，对时间索引分组操作来聚合运算。</p>
<p>参数：</p>
<ul>
<li><p><code>rule</code>：所需采样频率的字符串</p>
<p>  | 字符串    | 含义                                                         |<br>  | ——— | ———————————————————— |<br>  | B         | 营业日频率<br>(business day frequency)                     |<br>  | C         | 自定义营业日频率<br>(custom business day frequency)        |<br>  | D         | 日历日频率<br>(calendar day frequency)                     |<br>  | W         | 每周一次频率<br>(weekly frequency)                         |<br>  | M         | 月末频率<br>(month <strong>end</strong> frequency)                      |<br>  | SM        | 月中和月末频率<br>(semi-month end frequency (<strong>15th</strong> and <strong>end</strong> of month)) |<br>  | BM        | 营业月末频率<br>(business month end frequency)             |<br>  | CBM       | 自定义月末频率<br>(custom business month end frequency)    |<br>  | MS        | 月初频率<br>(month <strong>start</strong> frequency)                    |<br>  | SMS       | 月初和月中频率<br>(semi-month start frequency (<strong>1st</strong> and <strong>15th</strong>)) |<br>  | BMS       | 营业月初频率<br>(business month start frequency)           |<br>  | CBMS      | 自定义营业月初频率<br>(custom business month start frequency) |<br>  | Q         | 季度末频率<br>(quater <strong>end</strong> frequency)                   |<br>  | BQ        | 营业季度末频率<br>(business quater end frequency)          |<br>  | QS        | 季度初频率<br>(quater start frequency)                     |<br>  | BQS       | 营业季度初频率<br>(business quater start frequency)        |<br>  | A / Y     | 年末频率<br>(year end frequency)                           |<br>  | BA / BY   | 营业年末频率<br>(business year end frequency)              |<br>  | AS / YS   | 年初频率<br>(year start frequency)                         |<br>  | BAS / BYS | 营业年初频率<br>(business year start frequency)            |<br>  | BH        | 营业小时频率<br>(business hour frequency)                  |<br>  | H         | 小时频率<br>(hourly frequency)                             |<br>  | T / min   | 分钟频率<br>(minutely frequency)                           |<br>  | S         | 秒频率<br>(secendly frequency)                             |<br>  | L / ms    | 毫秒频率<br>(milliseconds)                                 |<br>  | U / us    | 微秒频率<br>(microseconds)                                 |<br>  | N         | 纳秒频率<br>(nanoseconds)                                  |</p>
</li>
<li><p><code>axis=0</code>：需要采样的轴向(0为行方向)</p>
</li>
<li><p><code>closed</code>：在<strong>降</strong>采样时，各时间段<strong>哪一侧(left/right)是</strong>闭合的。</p>
</li>
<li><p><code>label</code>：在降采样时，index<strong>用区间的左界值还是右界值</strong>。</p>
</li>
</ul>
<hr>
<h4 id="空值相关"><a href="#空值相关" class="headerlink" title="空值相关"></a>空值相关</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">--snip--</span><br><span class="line"><span class="comment"># 赋空值</span></span><br><span class="line"><span class="comment"># NaN是C语言类型的空值，比直接赋值None更合适</span></span><br><span class="line">position.loc[position.city==<span class="string">'深圳'</span>, <span class="string">'city'</span>] = np.NaN</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计数据框中每列缺失值的数量（每列缺失的行数）</span></span><br><span class="line">position.isnull().sum()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计数据框中每列有多少非空值(非空行)</span></span><br><span class="line"><span class="comment"># 方式一：</span></span><br><span class="line">position.notnull().sum</span><br><span class="line"><span class="comment"># 方式二：</span></span><br><span class="line">position.shape[<span class="number">0</span>] - position.isnull().sum()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对空值进行填充</span></span><br><span class="line">position.fillna(<span class="number">1</span>, inplace=<span class="literal">True</span>) <span class="comment"># 统一填充</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除空值所在的行(默认)或列</span></span><br><span class="line">position.dropna()</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="去重"><a href="#去重" class="headerlink" title="去重"></a>去重</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查找重复值(默认：第一次遇到不会当作重复值，将第二次开始遇到的值作为重复值看待)</span></span><br><span class="line">position[position.duplicated()]</span><br><span class="line"></span><br><span class="line">s = pd.Series([<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line"><span class="comment"># 判断是否有重复</span></span><br><span class="line">s.is_unique</span><br><span class="line"></span><br><span class="line">s[s.duplicated()] <span class="comment"># 会筛选出索引为1处对应的值1，索引为0处的1不会被筛选出来</span></span><br><span class="line">s[s.duplicated(keep=<span class="string">'last'</span>)] <span class="comment"># 保留最后一个重复的值，即索引为0处的1会被筛选出来</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 去重</span></span><br><span class="line">s.drop_duplicates() <span class="comment"># 默认保留第一个重复值(keep=’first')</span></span><br><span class="line"><span class="comment"># 获取每月的消费人数 (需要根据user_id去重)</span></span><br><span class="line"><span class="comment"># 方式一</span></span><br><span class="line">plt.plot(df[<span class="string">'user_id'</span>].apply(<span class="keyword">lambda</span> x:len(x.drop_duplicates())))</span><br><span class="line"><span class="comment"># 方式二</span></span><br><span class="line">d = df.groupby([<span class="string">'month'</span>, <span class="string">'user_id'</span>]).count().reset_index()</span><br><span class="line">plt.plot(d.groupby(<span class="string">'month'</span>)[<span class="string">'user_id'</span>].count())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回去重后的列</span></span><br><span class="line">s.unique()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回去重后的元素个数</span></span><br><span class="line">s.nunique()</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="移动数据：shift"><a href="#移动数据：shift" class="headerlink" title="移动数据：shift()"></a>移动数据：<code>shift()</code></h4><p>参数：</p>
<ul>
<li><p><code>periods</code>：移动的<strong>幅度</strong>(可正可负)，<strong>默认为1</strong>。</p>
<p>  只移动数据，<strong>不移动索引，移动之后没有对应值的，赋值为<code></code>NaN`</strong></p>
</li>
<li><p><code>freq</code>：用于<strong>时间序列索引</strong>，<strong>默认为<code>None</code></strong></p>
<ul>
<li><code>DateOffset</code></li>
<li><code>timedelta</code></li>
<li><p><code>time rule string</code></p>
<p>按照参数值<strong>移动时间索引</strong>，<strong>不移动数据值</strong>。</p>
</li>
</ul>
</li>
<li><p><code>axis</code>：指定<strong>移动方向</strong></p>
<ul>
<li><code>0</code>：上下移动(<strong>默认</strong>)</li>
<li><code>1</code>：左右移动</li>
</ul>
</li>
</ul>
<hr>
<h4 id="apply"><a href="#apply" class="headerlink" title="apply()"></a>apply()</h4><p><code>apply()</code>可以<strong>将函数应用到所有的行/列上进行处理</strong>。</p>
<ul>
<li><p><code>apply()</code>中的匿名函数<code></code>lambda<code>中的</code>x`<strong>到底指代什么</strong>：</p>
<ol>
<li><p>对<strong>某一列</strong>操作时：</p>
<p> 每一个x<strong>依次对应各行</strong>的具体值</p>
</li>
<li><p>对<strong>多个列</strong>(axis<strong>=0</strong>，默认)操作时：</p>
<p> 每一个x<strong>依次对应每一列</strong></p>
</li>
<li><p>对<strong>多个列</strong>(axis<strong>=1</strong>)操作时：</p>
<p> 每一个x<strong>依次对应每一行</strong>(依次对每个单元格进行操作)</p>
</li>
</ol>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Series级别</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用匿名函数，向 position表格中的avg列的每一行 都在末尾添加一个字符k</span></span><br><span class="line">position.avg.apply(<span class="keyword">lambda</span> x:str(x)+<span class="string">'k'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显式创建函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> x &gt; <span class="number">20</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'20+k'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> str(x)+<span class="string">'k'</span></span><br><span class="line"></span><br><span class="line">position.avg.apply(func)</span><br><span class="line"><span class="comment"># -----------------------------------------------</span></span><br><span class="line"><span class="comment"># DataFrame级别</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式一</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> x.avg &gt; <span class="number">20</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'20+k'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'0~20k'</span></span><br><span class="line"></span><br><span class="line"> position.apply(func, axis=<span class="number">1</span>) <span class="comment"># axis=1应用于每行；axis=0应用于每列</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式二</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> x &gt; <span class="number">20</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'20+k'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'0~20k'</span></span><br><span class="line"></span><br><span class="line"> position.apply(<span class="keyword">lambda</span> x:func(x.avg), axis=<span class="number">1</span>) <span class="comment"># axis=1应用于每行；axis=0应用于每列</span></span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><p>匿名函数lambda中<strong>条件语句</strong>的使用</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 条件语句为 A if 条件 else B</span></span><br><span class="line"><span class="comment"># 即 满足条件则输出A，否则输出B</span></span><br><span class="line">x.apply(<span class="keyword">lambda</span> x:<span class="string">'1'</span> <span class="keyword">if</span> x&gt;= <span class="number">0</span> <span class="keyword">else</span> <span class="string">'0'</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<p>将<code>apply()</code><strong>应用到聚合函数上</strong></p>
<p>获取<strong>不同城市</strong>中工资水平<strong>前五</strong>的信息：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(x, n)</span>:</span></span><br><span class="line">    r = x.sort_values(<span class="string">'avg'</span>, ascending=<span class="literal">False</span>) <span class="comment"># 按工资降序排序</span></span><br><span class="line">    <span class="keyword">return</span> r[:n] <span class="comment"># 返回前n</span></span><br><span class="line"></span><br><span class="line">position.groupby(<span class="string">'city'</span>).apply(func, n=<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="Pandas中map-apply-和applymap-的区别"><a href="#Pandas中map-apply-和applymap-的区别" class="headerlink" title="Pandas中map(), apply()和applymap()的区别"></a>Pandas中<code>map()</code>, <code>apply()</code>和<code>applymap()</code>的区别</h4><p>参考：<a href="https://blog.csdn.net/maymay_/article/details/80229053" target="_blank" rel="noopener">Pandas中的map(), apply()和applymap()的应用</a></p>
<p><strong>它们的区别在于应用的对象不同</strong>：</p>
<ul>
<li><p><code>map()</code></p>
<p>  是一个Series的函数，将一个自定义的函数<strong>应用于Series结构中的每个元素</strong></p>
</li>
<li><p><code>apply()</code></p>
<p>  将函数作用于<strong>DataFrame</strong>中的<strong>每个行</strong>或者<strong>列</strong></p>
</li>
<li><p><code>applymap()</code></p>
<p>  将函数作用于<strong>DataFrame</strong>中的<strong>每个元素</strong></p>
</li>
</ul>
<hr>
<h4 id="数据透视"><a href="#数据透视" class="headerlink" title="数据透视"></a>数据透视</h4><p><code>pivot_table()</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">position.pivot_table(index=[<span class="string">'city'</span>, <span class="string">'education'</span>], </span><br><span class="line">                     columns=<span class="string">'workYear'</span>,</span><br><span class="line">                     values=[<span class="string">'avg'</span>, <span class="string">'top'</span>], </span><br><span class="line">                     margins=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># index 指定索引（可多重）</span></span><br><span class="line"><span class="comment"># columns 可选，用于细分数据(相当于Excel透视表里的列标签)</span></span><br><span class="line"><span class="comment"># values 筛选列(相当于Excel透视表里的数值)</span></span><br><span class="line"><span class="comment"># margins=True 对各列进行汇总计算，默认为False</span></span><br><span class="line"><span class="comment"># aggfunc 应用于参数values</span></span><br><span class="line"></span><br><span class="line">position.pivot_table(index=[<span class="string">'city'</span>, <span class="string">'education'</span>], </span><br><span class="line">                     columns=<span class="string">'workYear'</span>,</span><br><span class="line">                     values=[<span class="string">'avg'</span>, <span class="string">'top'</span>], </span><br><span class="line">                     aggfunc=&#123;<span class="string">'avg'</span>:<span class="string">'mean'</span>, <span class="string">'top'</span>:np.sum&#125;).reset_index().to_csv(<span class="string">'test.csv'</span>) <span class="comment"># avg求平均值，对top求和</span></span><br></pre></td></tr></table></figure>
<p>注：数据透视<strong>不适合用来去重</strong></p>
<hr>
<h3 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h3><ul>
<li>安装相关工具包</li>
</ul>
<p><code>pip install pymysql</code></p>
<p><strong>注意：</strong>如果是安装了Anaconda，<strong>要在Jupyter Notebook中载入pymysql包</strong>，则<strong>必须在Jupyter Notebook中打开Python3或Ternimal的页面输入上述代码</strong>。另外单独安装的Python是独立于Anaconda的，两者下载的工具包可能无法通用。</p>
<ul>
<li><p>连接</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">conn = pymysql.connect(</span><br><span class="line">	host = <span class="string">'localhost'</span>, <span class="comment"># 本地数据库，也可输入 '127.0.0.1'</span></span><br><span class="line">    user = <span class="string">'root'</span>,</span><br><span class="line">    password = <span class="string">'123456'</span>,</span><br><span class="line">    db = <span class="string">'test'</span>,</span><br><span class="line">    port = <span class="number">3306</span>,</span><br><span class="line">    charset = <span class="string">'utf8'</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询数据库</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cur = conn.cursor() <span class="comment"># 获取游标</span></span><br><span class="line">cur.execute(<span class="string">'SELECT * FROM courses'</span>) <span class="comment"># 执行SQL语句</span></span><br><span class="line">data = cur.fetchall() <span class="comment"># 调取SQL语句执行后的结果(元组的形式)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> d <span class="keyword">in</span> data:</span><br><span class="line">    print(d[<span class="number">0</span>], d[<span class="number">1</span>], d[<span class="number">2</span>])</span><br></pre></td></tr></table></figure>
</li>
<li><p>提交对数据库的修改</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conn.commit()</span><br></pre></td></tr></table></figure>
</li>
<li><p>关闭数据库的连接</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cur.close()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="使用Pandas对数据库进行操作"><a href="#使用Pandas对数据库进行操作" class="headerlink" title="使用Pandas对数据库进行操作"></a>使用Pandas对数据库进行操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reader</span><span class="params">(query, db=<span class="string">'data'</span>)</span>:</span></span><br><span class="line">    sql = query</span><br><span class="line">	engine = create_engine(<span class="string">'mysql+pymysql://root:123456@localhost:3306/&#123;0&#125;?charset=utf8'</span>.format(db)) <span class="comment"># 允许使用pymysql方法连接mysql数据库</span></span><br><span class="line">	df = pd.read_sql(sql, engine) <span class="comment"># 将数据库中数据作为DataFrame读取</span></span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"></span><br><span class="line">reader(<span class="string">"SHOW TABLES"</span>)</span><br><span class="line"></span><br><span class="line">df_company = reader(<span class="string">"SELECT * FROM company"</span>)</span><br><span class="line">df_dataanalyst = reader(<span class="string">"SELECT * FROM dataanalyst"</span>)</span><br><span class="line">merged = pd.merge(df_dataanalyst, df_company, on=<span class="string">'companyId'</span>)</span><br><span class="line"></span><br><span class="line">result = merged.groupby([<span class="string">'city'</span>, <span class="string">'companyFullName'</span>]).count()[<span class="string">'positionId'</span>].reset_index()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入</span></span><br><span class="line">result.to_sql(name=<span class="string">'newtable'</span>, </span><br><span class="line">             con=<span class="string">'mysql+pymysql://root:123456@localhost:3306/data?charset=utf8'</span>,</span><br><span class="line">             if_exists=<span class="string">'append'</span>，<span class="comment">#  表不存在时，创建新表(if_exists默认为fail，表不存在时无法写入)，但为了符合数据库中的数据格式要求，最好按默认的fail</span></span><br><span class="line">             index = <span class="literal">False</span>) <span class="comment"># 不将索引作为字段写入数据库</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Matplotlib"><a href="#Matplotlib" class="headerlink" title="Matplotlib"></a>Matplotlib</h2><p>Matplotlib是一个Python的<strong>2D绘图库</strong>。它以各种<strong>硬拷贝格式</strong>和<strong>跨平台的交互式环境</strong>生成<strong>出版质量级别的图形</strong>。我们通常<strong>使用该库将数据可视化</strong>，更形象直观地暴露问题所在。</p>
<hr>
<h2 id="Scikit-learn"><a href="#Scikit-learn" class="headerlink" title="Scikit-learn"></a>Scikit-learn</h2><p>Scikit-learn(Sklearn)是<strong>机器学习中常用的第三方模块</strong>，<strong>对常用的机器学习方法进行了封装</strong>，是建立在Numpy、Scipy、Matplotlib之上，简单高效的<strong>数据挖掘</strong>和<strong>数据分析工具</strong>。</p>
<hr>
<h2 id="Jupyter"><a href="#Jupyter" class="headerlink" title="Jupyter"></a>Jupyter</h2><p>Jupyter是一个<strong>Web应用程序</strong>，可以用来<strong>编写Python代码</strong>、<strong>图表展示</strong>、<strong>数值处理和转换</strong>、<strong>数值模拟</strong>和<strong>统计建模</strong>等各种任务。</p>
<h3 id="Jupyter-Notebook"><a href="#Jupyter-Notebook" class="headerlink" title="Jupyter Notebook"></a>Jupyter Notebook</h3><table>
<thead>
<tr>
<th>快捷键</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>Tab</td>
<td>自动补全</td>
</tr>
<tr>
<td>Shift + Tab</td>
<td>显示函数示例</td>
</tr>
<tr>
<td>Shift + Enter</td>
<td>执行当前，并跳转至下一Cell</td>
</tr>
<tr>
<td>Ctrl + Enter</td>
<td>执行当前，并留在当前Cell</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="Anaconda"><a href="#Anaconda" class="headerlink" title="Anaconda"></a>Anaconda</h2><p><strong>Anaconda</strong>是一个免费开源的<strong>Python和R语言的发行版本</strong>，用于<strong>计算科学（数据科学、机器学习、大数据处理和预测分析）</strong>，Anaconda致力于简化包管理和部署。Anaconda的包使用<strong>软件包管理系统Conda</strong>进行管理。</p>
<p>Anaconda<strong>3</strong>默认包含Python <strong>3.7</strong>，但是用户<strong>可以创建虚拟环境来使用任意版本的Python包</strong>。</p>
<h3 id="Anaconda-Navigator"><a href="#Anaconda-Navigator" class="headerlink" title="Anaconda Navigator"></a>Anaconda Navigator</h3><p>Anaconda Navigator是包含在Anaconda中的<strong>图形用户界面</strong>，用户可以通过Anaconda Navigator启动应用，在<strong>不使用命令行的情况下管理软件包、创建虚拟环境和管理路径</strong>。</p>
<p>Anaconda Navigator包含如下应用：</p>
<ul>
<li>JupyterLab</li>
<li>Jupyter Notebook</li>
<li>QtConsole</li>
<li>Spyder</li>
<li>Glueviz</li>
<li>Orange</li>
<li>Rstudio</li>
<li>Visual Studio Code</li>
</ul>
<hr>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id="利用apply-，使用自定义函数更新DataFrame每行单元格的内容，但是得到的不是DataFrame对象"><a href="#利用apply-，使用自定义函数更新DataFrame每行单元格的内容，但是得到的不是DataFrame对象" class="headerlink" title="利用apply()，使用自定义函数更新DataFrame每行单元格的内容，但是得到的不是DataFrame对象"></a>利用apply()，使用自定义函数更新DataFrame每行单元格的内容，但是得到的不是DataFrame对象</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># # 定性 用户18个月的消费</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">active_status</span><span class="params">(data)</span>:</span></span><br><span class="line">    status = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">18</span>): <span class="comment"># 一共18个月的记录</span></span><br><span class="line">        <span class="comment"># 如果本月没有消费</span></span><br><span class="line">        <span class="keyword">if</span> data[i] == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> len(status) &gt; <span class="number">0</span>: <span class="comment"># 记录过状态</span></span><br><span class="line">                <span class="keyword">if</span> status[i<span class="number">-1</span>] == <span class="string">'unreg'</span>: <span class="comment"># 上个月是未注册</span></span><br><span class="line">                    status.append(<span class="string">'unreg'</span>) <span class="comment"># 仍然是未注册</span></span><br><span class="line">                <span class="keyword">else</span>:                     <span class="comment"># 之前已注册(有过消费)</span></span><br><span class="line">                    status.append(<span class="string">'unactive'</span>) <span class="comment"># 为不活跃</span></span><br><span class="line">            <span class="keyword">else</span>:                         <span class="comment"># 没记录过状态</span></span><br><span class="line">                status.append(<span class="string">'unreg'</span>) <span class="comment"># 为未注册</span></span><br><span class="line">                </span><br><span class="line">        <span class="comment"># 本月有消费</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> len(status) == <span class="number">0</span>: <span class="comment"># 没记录过状态</span></span><br><span class="line">                status.append(<span class="string">'new'</span>) <span class="comment"># 新用户(第一次消费)</span></span><br><span class="line">            <span class="keyword">else</span>:               <span class="comment"># 之前记录过</span></span><br><span class="line">                <span class="keyword">if</span> status[i<span class="number">-1</span>] == <span class="string">'unactive'</span>: <span class="comment"># 上个月为不活跃</span></span><br><span class="line">                    status.append(<span class="string">'return'</span>)   <span class="comment"># 更新为 回流</span></span><br><span class="line">                <span class="keyword">elif</span> status[i<span class="number">-1</span>] == <span class="string">'unreg'</span>: <span class="comment"># 上个月为未注册</span></span><br><span class="line">                    status.append(<span class="string">'new'</span>)     <span class="comment"># 新用户(第一次消费)</span></span><br><span class="line">                <span class="keyword">else</span>:                      </span><br><span class="line">                    status.append(<span class="string">'active'</span>) <span class="comment"># 更新为活跃</span></span><br><span class="line">    <span class="keyword">return</span> status</span><br><span class="line"></span><br><span class="line">cdnow_purchase.apply(active_status, axis=<span class="number">1</span>) <span class="comment"># 对每一行进行操作</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>原因：</p>
<p>  <strong>自定义函数的返回值</strong>是<strong>列表</strong>，而<strong>不是Series</strong>，导致apply()之后的结果不是一个DataFrame对象。</p>
</li>
<li><p>解决方法：</p>
<p>  将自定义函数的<strong>返回值转换为Series对象</strong></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--snip--</span><br><span class="line"><span class="keyword">return</span> pd.Series(status, index=cdnow_purchase.columns) <span class="comment"># index参数是原DataFrame对象的各列列名</span></span><br></pre></td></tr></table></figure>
</li>
</ul>

      
    </div>

    

    
    
    

    

    
      
    
    

    
      <div>
        




  



<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Hunter</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    
    <a href="https://hunter1023.github.io/2020/06/13/Python之数据分析/" title="Python之数据分析">https://hunter1023.github.io/2020/06/13/Python之数据分析/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Python/" rel="tag"><i class="fa fa-tag"></i> Python</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/06/01/Excel技巧/" rel="next" title="Excel技巧">
                <i class="fa fa-chevron-left"></i> Excel技巧
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/06/13/Python入门到实践/" rel="prev" title="Python入门到实践">
                Python入门到实践 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
				<a href="/">
				  <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Hunter">
				</a>
            
              <p class="site-author-name" itemprop="name">Hunter</p>
              <div class="site-description motion-element" itemprop="description">Tough times never last, but tough people do.</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">27</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">13</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">35</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Numpy"><span class="nav-number">1.</span> <span class="nav-text">Numpy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pandas"><span class="nav-number">2.</span> <span class="nav-text">Pandas</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#两种数据结构"><span class="nav-number">2.1.</span> <span class="nav-text">两种数据结构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Series-一维"><span class="nav-number">2.1.1.</span> <span class="nav-text">Series  (一维)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DataFrame-二维"><span class="nav-number">2.1.2.</span> <span class="nav-text">DataFrame (二维)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Series通过reset-index-可以转换为DataFrame"><span class="nav-number">2.1.2.1.</span> <span class="nav-text">Series通过reset_index()可以转换为DataFrame</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#代表反转"><span class="nav-number">2.1.3.</span> <span class="nav-text">~代表反转</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#筛选"><span class="nav-number">2.1.4.</span> <span class="nav-text">筛选</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#增删"><span class="nav-number">2.1.5.</span> <span class="nav-text">增删</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pandas基础命令速查表"><span class="nav-number">2.2.</span> <span class="nav-text">Pandas基础命令速查表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#读取-写入文件"><span class="nav-number">2.3.</span> <span class="nav-text">读取/写入文件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#读取"><span class="nav-number">2.3.1.</span> <span class="nav-text">读取</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#写入"><span class="nav-number">2.3.2.</span> <span class="nav-text">写入</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数"><span class="nav-number">2.4.</span> <span class="nav-text">函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#筛选函数"><span class="nav-number">2.4.1.</span> <span class="nav-text">筛选函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#聚合函数"><span class="nav-number">2.4.2.</span> <span class="nav-text">聚合函数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#多表关联"><span class="nav-number">2.4.2.1.</span> <span class="nav-text">多表关联</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#文本函数"><span class="nav-number">2.4.3.</span> <span class="nav-text">文本函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#时间相关"><span class="nav-number">2.4.4.</span> <span class="nav-text">时间相关</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#重新采样"><span class="nav-number">2.4.4.1.</span> <span class="nav-text">重新采样</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#空值相关"><span class="nav-number">2.4.5.</span> <span class="nav-text">空值相关</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#去重"><span class="nav-number">2.4.6.</span> <span class="nav-text">去重</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#移动数据：shift"><span class="nav-number">2.4.7.</span> <span class="nav-text">移动数据：shift()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#apply"><span class="nav-number">2.4.8.</span> <span class="nav-text">apply()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Pandas中map-apply-和applymap-的区别"><span class="nav-number">2.4.9.</span> <span class="nav-text">Pandas中map(), apply()和applymap()的区别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#数据透视"><span class="nav-number">2.4.10.</span> <span class="nav-text">数据透视</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#连接数据库"><span class="nav-number">2.5.</span> <span class="nav-text">连接数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#使用Pandas对数据库进行操作"><span class="nav-number">2.5.1.</span> <span class="nav-text">使用Pandas对数据库进行操作</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Matplotlib"><span class="nav-number">3.</span> <span class="nav-text">Matplotlib</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Scikit-learn"><span class="nav-number">4.</span> <span class="nav-text">Scikit-learn</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Jupyter"><span class="nav-number">5.</span> <span class="nav-text">Jupyter</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Jupyter-Notebook"><span class="nav-number">5.1.</span> <span class="nav-text">Jupyter Notebook</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Anaconda"><span class="nav-number">6.</span> <span class="nav-text">Anaconda</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Anaconda-Navigator"><span class="nav-number">6.1.</span> <span class="nav-text">Anaconda Navigator</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#问题"><span class="nav-number">7.</span> <span class="nav-text">问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#利用apply-，使用自定义函数更新DataFrame每行单元格的内容，但是得到的不是DataFrame对象"><span class="nav-number">7.1.</span> <span class="nav-text">利用apply()，使用自定义函数更新DataFrame每行单元格的内容，但是得到的不是DataFrame对象</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hunter</span>

  

  
</div>









<span id="busuanzi_container_site_uv">
  本站访问次数：<span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
</span>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  

  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  















  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/schemes/muse.js?v=7.0.1"></script>



  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  
  

<script src="//cdn1.lncld.net/static/js/3.11.1/av-min.js"></script>



<script src="//unpkg.com/valine/dist/Valine.min.js"></script>

<script>
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'bfNJwb6OakQAqcsORwzGDDVj-gzGzoHsz',
    appKey: 'bSLvxGSfThsJp8vbhiMV4LUd',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false
  });
</script>




  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  

  
  

  


  

  

  

  

  

  

  

  

  
<style>
  .copy-btn {
    display: inline-block;
    padding: 6px 12px;
    font-size: 13px;
    font-weight: 700;
    line-height: 20px;
    color: #333;
    white-space: nowrap;
    vertical-align: middle;
    cursor: pointer;
    
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
    
    user-select: none;
    outline: 0;
  }

  .highlight-wrap .copy-btn {
    transition: opacity .3s ease-in-out;
    opacity: 0;
    padding: 2px 6px;
    position: absolute;
    
      right: 4px;
      top: 8px;
    
  }

  .highlight-wrap:hover .copy-btn,
  .highlight-wrap .copy-btn:focus {
    opacity: 1;
  }

  .highlight-wrap {
    position: relative;
  }
</style>
<script>
  $('.highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
        if (result) $(this).text('复制成功');
        else $(this).text('复制失败');
      
      ta.blur(); // For iOS
      $(this).blur();
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('复制');
      }, 300);
    }).append(e);
  })
</script>


</body>
</html>
